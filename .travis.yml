language: rust

os:
  - linux
  - osx

env:
- ARCH=i686
- ARCH=x86_64

rust: stable

before_install:
- if [[ $TRAVIS_OS_NAME == "linux" ]]; then sudo apt-get -qq update; fi
- if [[ $TRAVIS_OS_NAME == "linux" && $ARCH == "i686"   ]]; then sudo apt-get install -y gcc-multilib g++-multilib; fi
- if [[ $TRAVIS_OS_NAME == "linux" && $ARCH == "x86_64" ]]; then sudo apt-get install -y gcc-multilib g++-multilib; fi

before_script:
- curl https://sh.rustup.rs -sSf | sh -s -- -y --default-toolchain beta
- export PATH=~/.cargo/bin:$PATH
- if [[ $TRAVIS_OS_NAME == "linux" && $ARCH == "x86_64" ]]; then rustup target add x86_64-unknown-linux-musl; fi
- if [[ $TRAVIS_OS_NAME == "linux" && $ARCH == "i686"   ]]; then rustup target add i686-unknown-linux-gnu; fi
- if [[ $TRAVIS_OS_NAME == "osx"   && $ARCH == "i686"   ]]; then rustup target add i686-apple-darwin; fi
- which cargo
- which rustc
- cargo --version
- rustc --version

script:
- if [[ $TRAVIS_OS_NAME == "osx"   && $ARCH == "x86_64" ]]; then make test; fi
- if [[ $TRAVIS_OS_NAME == "linux" && $ARCH == "x86_64" ]]; then make test; fi
- if [[ $TRAVIS_OS_NAME == "osx"   && $ARCH == "i686"   ]]; then make release_osx32; fi
- if [[ $TRAVIS_OS_NAME == "osx"   && $ARCH == "x86_64" ]]; then make release_osx64; fi
- if [[ $TRAVIS_OS_NAME == "linux" && $ARCH == "i686"   ]]; then make release_lnx32; fi
- if [[ $TRAVIS_OS_NAME == "linux" && $ARCH == "x86_64" ]]; then make release_lnx64; fi

deploy:
  provider: releases
  api_key:
    secure: JrsrWS/rE/h6OuKIcxlFxZoLEvVAp1lWumEVifYeYhS/rHtqjla7coSMmnOTrWGEFkLP+EgjYYwG20SbbYJjEZ4gje7DtrWQwsCdSNBon/X86c5dbKzj+3apqxtoAjN8zwasn+HzRe2Nhn+B8RxQHwAvChOpfzORLDXsey1ZNwh+L6baip1ymYO3urP7wnQ/VnbS5JswZ4+AMxo9pNyQTrswv2JC4YjVH2h8ijdeMUdSiciVwbBFFRC9LdPRV6KyGA550i+LhRMzNQ25/qG6ZECTt3FRl6RaJZkNjnVv8lOV7cVM4uNt2V3Sa1qUktlCxoBZXwWAWnPbfKCCYM86gqncn1ZzbayBdugLxFm2L3HaK2cEmlGBKzKyy06lf9eUK02JTLdM/F/o6J34a0Uq15Bx0Qkid3y9UUD2evjb8MZQF7dPYl81G3rN5U6y698q5Wn544+jukrdbkKgrGrEdSb548hLc9WRU+yKHBkFjpx4pSVnhnO//3OkOfUC27iFrU6uOmPVBzBZb0cAyDDkHrW/Klz8dB35VlqMg4Zw7a4pRhcsNegUxSRE723OkeXIi60HDc8bgc2nVGjU2XbqD7wTND4viiULhwhWwqi7Cvxr9cBHMGGl/H9oXrBk/51m8RGw7BSyqNDGsXuUgvgTMFiSzZGWqWQn8IvKjQoyrBE=
  file:
    - amber-*.zip
  file_glob: true
  skip_cleanup: true
  on:
    repo: dalance/amber
    tags: true
